# Общее положение


### Основное правило

Код проекта должен быть понятным и легко читаемым. Конечно, всё это относительно, но нужно стараться придерживаться этому правилу. Не нужно мудрить, нам же поддерживать этот код.


### Структура проекта

Проект модульный. Теоретически каждый модуль может быть собран отдельно от всего проекта. Модули могут иметь между собой зависимости. К примеру, в данный момент все модули зависимы от модуля `core`.

Все существующие модули находятся в директории `/source/` проекта lexbor.


### Зависимости

Проект развивается без внешних зависимостей. Не то чтобы мне по фану писать не раз уже всеми написанные алгоритмы, вроде AVL Tree, Binary Search Tree и так далее, важно использовать собственный подход в создании объектов и управлении памятью.

Так же, большенство реализованных алгоритмов не являются "чистыми", логика их как-то изменена/оптимизирована под нужды проекта.

Нет никаких противоречий использовать сторонний код, но зачастую всё что нужно проекту легче написать самостоятельно чем адаптировать чей-то код, лицензии.


### Платформозависимый код

Не смотря на тот факт, что проект пишется на чистом Си (C99) без внешних зависимостей реализация некоторых функций зависит от конкретной платформы. А именно: многопоточность, таймеры, ввод-вывод, блокировки (spinlock, mutex).

Для этого реализован отдельный модуль `port` который имеет свою собственную структуру и правила сборки отличные от остальных модулей.


### Память

Для работы с динамической памятью используются четыре функции:
```C
void *
lexbor_malloc(size_t size);

void *
lexbor_calloc(size_t num, size_t size);

void *
lexbor_realloc(void *dst, size_t size);

void *
lexbor_free(void *dst);
```

Функции определены в `lexbor/core/lexbor.h`, реализованы в `port/*/lexbor/core/memory.c` и могут быть переопределены.

Из названий понятно, что это обвязки для стандартных функций `malloc, calloc, realloc, free`.
В отличии от стандартной функции `free` функция `lexbor_free` возвращает значение `void *` которое всегда равно `NULL` — это своеобразный синтаксический сахар, чтобы отдельно не занулять переменные после освобождения.

К примеру,
```C
if (object->table) {
	object->table = lexbor_free(object->table);
}
```

Иначе пришлось бы писать:
```C
if (object->table) {
	 lexbor_free(object->table);
	 object->table = NULL:
}
```

**О работе с памятью**

Плохим тоном считается постоянное выделение и освобождение памяти. Выделенную один раз память можно использовать многократно — об этом часто забывают.

Для примера, модуль `html` строит дерево `HTML` для которого создается много нод, 500 нод в среднем на одну страницу. У каждой ноды есть параметры. Если мы будем каждый раз дёргать `malloc`, а в случаи освобождения всех нод `free`, то программа у нас будет работать медленно, очень медленно.
Для этого в проекте созданы "менеджеры памяти/объектов" (mem pool) которые выделяют куски памяти под структуры и следят за ними. Читайте про `dobject` и `mraw`.



### Примеры

Для значимых участков кода создаются примеры его использования в директории `/examples/`. Это помогает осваивать код и показывает его возможности.


### Тестирование

Для всего, практически для всего, должны создаваться тесты в директории `/test/`. Проект большой, регрессия наступает очень быстро. 

Не нужно лениться, желательно всегда прогонять созданный/изменённый код с Runtime Sanitization: address, thread, undefined behavior и прочими инструментами по анализу кода, работы программы. К примеру, Valgrind.


### Контребьютеру

Если вы создали какой либо файл или внесли значительные изменения в существующий то добавляете себя как автора в этот файл после информаци о лицензии.

```C
/*
 ...
 
 Author: Имя Фамилия <<почта>@<автора>.com>
 Author: Имя Фамилия <<почта>@<автора>.com>
 Author: Имя Фамилия <<почта>@<автора>.com>
*/
```

Пожалуйста, не стоит вносить себя как автора если вы исправили грамматическую ошибку или поменяли имя функции/переменной.

Так же, внося добавления/изменения в существующий код вы соглашаетесь на то что ваш код будет распространяться под текущей лицензией проекта. Внесённые вами добавления/изменения могут быть изменены или удален из проекта в любое время, могут быть перелицензированны, и распространяться вместе с проектом неопределенное время.


### Лицензия

Текущая лицензия проекта ``
Смотрите файл LICENSE в корне проекта.
