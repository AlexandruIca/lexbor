# Заметки


### Пропуски

Есть такие моменты когда токенизатор не создаст токен для данных и они будут считаться "утраченными". То есть, идеально восстановить страницу после токенизатора нельзя.
Примеры:
```HTML
</>
</+
<asd
<asd/
<div name 
<div name = "sd 
<div name = 'sd 
<div name = sd
<div name = "sd" 
<![[CDATA 
```

### Имя тега

Если в имени тега (но не начинается с него) есть `\0` то он должен конвертироваться в `U+FFFD REPLACEMENT CHARACTER`.


### Атрибуты

Все дубли удаляются. Пример:
```HTML
<div abc=1234 abc=lalala>
```

получится:
```HTML
<div abc=1234>
```

### Особенности работы парсера

#### Создание элементов

Все элементы создаются функцией `lxb_html_tree_create_node` (и только ей). Дело в том, что для неизвестных тегов (тех, что создал пользователь) интерфейс создания выбирается в зависимости от текущего namespace. Более того в custom elements будет свой выбор интерфейса, ведь там есть наследование которое пользователь сам выбирает.

### Удаление элементов

Нам ничего не мешает вызывать функцию `lxb_html_interface_destroy` и элемент с любым интерфейсом будет удален (освободится память). Но если элемент при создании что-то инициализирует для себя то лучше вызывать непосредственно его функцию уничтожения.


### Теги

#### Неизвестные

Для всех неизвестных тегов `interface` в структуре `lxb_html_tag_data_t` обнулён. При построении дерева есть логика выбора интерфейса для таких тегов. Смотрите `Создание элементов`


### Особенности токенизатора


# Текущие задачи

1. Необходимо делать все переключения state токенизатора до отправления токена на обработку потому что после применения правил он может поменяться.
2. Проверить все `begin` и `end` на правильный NULL и правильную обработку `EOF`
3. Сделать все str_res shared?

4. Разобраться с `lxb_html_tree_adoption_agency_algorithm`. Проверить если он вернул `true` надо ли идти в обработку закрывающего тега и выполнять ли при этом другие условия? — походу не надо.
5.  Именя тегов разного размера. Смотреть в `Any other start tag` в `12.2.6.5 The rules for parsing tokens in foreign content`
6.  Обработка скриптов (это не сейчас)
7.  Сериализация template
8.  Доделать `lxb_html_tree_create_node` создание элементов для SVG и прочего.
9.  Поменять `lxb_html_tree_create_node` на `lxb_html_create_node`
